---
title: "FastAPIμ™€ PostgreSQLμ„ ν™μ©ν• μ•„μ›ƒμ†μ‹± ν¬λ΅¤λ¬ κ°λ°"
date: "2025-02-12"
category: "backend"
description: "ν¬λ΅¤λ¬ ν”„λ΅μ νΈμ— μ•”νΈν™” μ‹μ¤ν…μ„ λ„μ…ν–μ–΄μ”! Fernetμ„ ν™μ©ν• λ€μΉ­ν‚¤ μ•”νΈν™”λ΅ ν”„λ΅μ νΈ IDλ¥Ό μ•μ „ν•κ² λ³΄νΈν•κ³ , CryptoUtil ν΄λμ¤λ΅ νΈλ¦¬ν•κ² κ΄€λ¦¬ν•  μ μκ² λμ—λ‹µλ‹λ‹¤. π”’"
tags:
  [
    "FastAPI",
    "PostgreSQL",
    "Python",
    "Crawler",
    "asyncio",
    "SQLAlchemy",
    "λΉ„λ™κΈ°μ²λ¦¬",
    "λ°μ΄ν„°μμ§‘",
    "μ‹¤μ‹κ°„μ²λ¦¬",
    "μ•”νΈν™”",
    "Fernet",
    "λ³΄μ•",
    "cryptography",
    "λ°μ΄ν„°λ³΄νΈ",
  ]
thumbnail: "/images/fastapi.png"
---

μ΄λ² κΈ€μ—μ„λ” **μ•”νΈν™” μ‹μ¤ν… κµ¬ν„**μ— λ€ν•΄ μμ„Έν μ†κ°ν• κ²μ”!

---

# μ•”νΈν™” μ‹μ¤ν… κµ¬ν„: CryptoUtil ν΄λμ¤μ™€ ν”„λ΅μ νΈ ID λ³΄νΈ

μ•λ…•ν•μ„Έμ”, μ—¬λ¬λ¶„!  
μ΄μ „ κΈ€λ“¤μ—μ„ λ°μ΄ν„°λ² μ΄μ¤ λΉ„λ™κΈ° μ²λ¦¬, μ„Έμ… κ΄€λ¦¬, λ¨λΈ κ°μ„ , ν¬λ΅¤λ¬ μ¤μΌ€μ¤„λ¬ λ“±μ— λ€ν•΄ λ‹¤λ¤λ”λ°μ”, μ΄λ² κΈ€μ—μ„λ” **μ•”νΈν™” μ‹μ¤ν… κµ¬ν„**μ— λ€ν•΄ μ΄μ•ΌκΈ°ν•΄λ³΄λ ¤κ³  ν•©λ‹λ‹¤.

μ°λ¦¬ ν”„λ΅μ νΈμ—μ„λ” λ³΄μ•μ΄ λ§¤μ° μ¤‘μ”ν• μ”μ† μ¤‘ ν•λ‚μ…λ‹λ‹¤. νΉν, ν”„λ΅μ νΈ IDμ™€ κ°™μ΄ λ―Όκ°ν• μ •λ³΄λ” μ•”νΈν™”λ¥Ό ν†µν•΄ μ™Έλ¶€λ΅ λ…Έμ¶λμ§€ μ•λ„λ΅ λ³΄νΈν•  ν•„μ”κ°€ μμ£ . μ΄λ² κΈ€μ—μ„λ” **Fernet**μ„ ν™μ©ν• λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹μ„ μ μ©ν•μ—¬, ν”„λ΅μ νΈ IDμ μ•”νΈν™”μ™€ λ³µνΈν™”λ¥Ό κµ¬ν„ν•λ” λ°©λ²•μ„ μ†κ°ν•κ² μµλ‹λ‹¤.

---

## 1. μ•”νΈν™”κ°€ ν•„μ”ν• μ΄μ 

- **λ³΄μ• κ°•ν™”:**  
  λ°μ΄ν„°κ°€ μ™Έλ¶€μ— λ…Έμ¶λλ©΄ μ•…μμ μΈ κ³µκ²©μ— μ·¨μ•½ν•΄μ§‘λ‹λ‹¤. μ•”νΈν™”λ¥Ό ν†µν•΄ μ¤‘μ”ν• μ •λ³΄(μ: ν”„λ΅μ νΈ ID)λ¥Ό μ•μ „ν•κ² λ³΄νΈν•  μ μμµλ‹λ‹¤.

- **λ°μ΄ν„° λ¬΄κ²°μ„± μ μ§€:**  
  μ•”νΈν™”λ λ°μ΄ν„°λ” μ „μ†΅ μ¤‘ λ³€μ΅° μ—¬λ¶€λ¥Ό μ‰½κ² ν™•μΈν•  μ μμ–΄, λ°μ΄ν„°μ μ‹ λΆ°μ„±μ„ λ³΄μ¥ν•  μ μμµλ‹λ‹¤.

- **κ·μ • μ¤€μ:**  
  μ—¬λ¬ λ³΄μ• κ·μ μ™€ μ»΄ν”λΌμ΄μ–Έμ¤ μ”κ±΄μ„ λ§μ΅±μ‹ν‚¤κΈ° μ„ν•΄ λ―Όκ° μ •λ³΄λ¥Ό μ•”νΈν™”ν•λ” κ²ƒμ€ ν•„μμ μ…λ‹λ‹¤.

---

## 2. Fernet λ€μΉ­ν‚¤ μ•”νΈν™”λ€?

**Fernet**μ€ νμ΄μ¬μ [cryptography](https://cryptography.io/) λΌμ΄λΈλ¬λ¦¬μ—μ„ μ κ³µν•λ” λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹μ…λ‹λ‹¤.

- **λ€μΉ­ν‚¤ μ•”νΈν™”:** μ•”νΈν™”μ™€ λ³µνΈν™”μ— λ™μΌν• ν‚¤λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.
- **μ‚¬μ©λ²•μ΄ κ°„λ‹¨:** λ‡ μ¤„μ μ½”λ“λ΅ κ°•λ ¥ν• μ•”νΈν™” κΈ°λ¥μ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤.
- **μ•μ „μ„±:** μ•”νΈν™”λ λ©”μ‹μ§€μ λ¬΄κ²°μ„±κ³Ό μΈμ¦μ„ λ³΄μ¥ν•©λ‹λ‹¤.

---

## 3. CryptoUtil ν΄λμ¤ κµ¬ν„

μ΄μ  μ‹¤μ λ΅ `CryptoUtil` ν΄λμ¤λ¥Ό κµ¬ν„ν•΄ λ³΄κ² μµλ‹λ‹¤. μ΄ ν΄λμ¤λ” μ•”νΈν™”μ™€ λ³µνΈν™” κΈ°λ¥μ„ μ κ³µν•λ©°, μ£Όλ΅ ν”„λ΅μ νΈ IDμ™€ κ°™μ€ λ―Όκ°ν• λ°μ΄ν„°λ¥Ό λ³΄νΈν•λ” λ° μ‚¬μ©λ©λ‹λ‹¤.

```python
from cryptography.fernet import Fernet

class CryptoUtil:
    def __init__(self, key: str):
        """
        μƒμ„±μ: μ•”νΈν™”μ— μ‚¬μ©ν•  Fernet μΈμ¤ν„΄μ¤λ¥Ό μ΄κΈ°ν™”ν•©λ‹λ‹¤.
        :param key: Fernet μ•”νΈν™” ν‚¤ (λ¬Έμμ—΄)
        """
        self.fernet = Fernet(key)

    def encrypt(self, data: str) -> str:
        """
        λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•©λ‹λ‹¤.
        :param data: μ•”νΈν™”ν•  λ¬Έμμ—΄ λ°μ΄ν„°
        :return: μ•”νΈν™”λ λ¬Έμμ—΄ (ν† ν°)
        """
        return self.fernet.encrypt(data.encode()).decode()

    def decrypt(self, token: str) -> str:
        """
        μ•”νΈν™”λ ν† ν°μ„ λ³µνΈν™”ν•©λ‹λ‹¤.
        :param token: μ•”νΈν™”λ λ¬Έμμ—΄ (ν† ν°)
        :return: λ³µνΈν™”λ μ›λ³Έ λ¬Έμμ—΄
        """
        return self.fernet.decrypt(token.encode()).decode()


# μμ‹ μ‚¬μ©λ²•
if __name__ == '__main__':
    # μ•”νΈν™” ν‚¤λ” λ³΄ν†µ ν™κ²½ λ³€μλ‚ μ„¤μ • νμΌμ—μ„ μ•μ „ν•κ² λ΅λ“ν•©λ‹λ‹¤.
    # μ—¬κΈ°μ„λ” μμ‹λ΅ μƒλ΅μ΄ ν‚¤λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    key = Fernet.generate_key()
    crypto_util = CryptoUtil(key)

    original_id = "project123"
    encrypted_id = crypto_util.encrypt(original_id)
    decrypted_id = crypto_util.decrypt(encrypted_id)

    print("μ›λ³Έ ν”„λ΅μ νΈ ID:", original_id)
    print("μ•”νΈν™”λ ν”„λ΅μ νΈ ID:", encrypted_id)
    print("λ³µνΈν™”λ ν”„λ΅μ νΈ ID:", decrypted_id)
```

### 3.1 μ½”λ“ μ„¤λ…

- **μ΄κΈ°ν™”:**  
  `__init__` λ©”μ„λ“μ—μ„ μ „λ‹¬λ°›μ€ μ•”νΈν™” ν‚¤λ΅ `Fernet` μΈμ¤ν„΄μ¤λ¥Ό μ΄κΈ°ν™”ν•©λ‹λ‹¤.

- **encrypt λ©”μ„λ“:**  
  λ¬Έμμ—΄ λ°μ΄ν„°λ¥Ό λ°”μ΄νΈλ΅ λ³€ν™ν• ν›„ μ•”νΈν™”ν•μ—¬, λ‹¤μ‹ λ¬Έμμ—΄λ΅ λ””μ½”λ”©ν•©λ‹λ‹¤.

- **decrypt λ©”μ„λ“:**  
  μ•”νΈν™”λ ν† ν°μ„ λ°”μ΄νΈλ΅ λ³€ν™ν•μ—¬ λ³µνΈν™”ν•κ³ , μ›λμ λ¬Έμμ—΄λ΅ λ””μ½”λ”©ν•©λ‹λ‹¤.

---

## 4. μ„¤μ •μ— μ•”νΈν™” ν‚¤ μ¶”κ°€ν•κΈ°

μ‹¤μ  μ΄μ ν™κ²½μ—μ„λ” μ•”νΈν™” ν‚¤λ¥Ό μ½”λ“μ— ν•λ“μ½”λ”©ν•μ§€ μ•κ³ , λ³΄μ• μ„¤μ • νμΌμ΄λ‚ ν™κ²½ λ³€μμ—μ„ λ΅λ“ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, `config.py` νμΌμ„ λ§λ“¤μ–΄ μ•„λμ™€ κ°™μ΄ μ‘μ„±ν•  μ μμµλ‹λ‹¤:

```python
import os

# ν™κ²½ λ³€μμ—μ„ μ•”νΈν™” ν‚¤λ¥Ό κ°€μ Έμ¤κ±°λ‚, κΈ°λ³Έκ°’μ„ μ„¤μ •ν•©λ‹λ‹¤.
ENCRYPTION_KEY = os.getenv("ENCRYPTION_KEY", Fernet.generate_key().decode())
```

μ΄λ ‡κ² μ„¤μ •ν•΄λ‘λ©΄, μ΄μ ν™κ²½μ—μ„ λ³„λ„μ μ•”νΈν™” ν‚¤λ¥Ό μ•μ „ν•κ² κ΄€λ¦¬ν•  μ μμ–΄ λ³΄μ•μ„±μ΄ ν•μΈµ κ°•ν™”λ©λ‹λ‹¤.

---

## 5. μ•”νΈν™” μ‹μ¤ν…μ μ μ©

μ΄μ  API μ—”λ“ν¬μΈνΈλ‚ λ°μ΄ν„° μ €μ¥ μ‹, ν”„λ΅μ νΈ IDλ¥Ό μ§μ ‘ λ…Έμ¶ν•λ” λ€μ‹  μ•”νΈν™”λ κ°’μ„ μ‚¬μ©ν•λ©΄ λ©λ‹λ‹¤.  
μλ¥Ό λ“¤μ–΄, ν”„λ΅μ νΈ μ΅°ν APIμ—μ„λ” ν΄λΌμ΄μ–ΈνΈμ—κ² μ•”νΈν™”λ IDλ¥Ό μ κ³µν•κ³ , μ΄ν›„ ν΄λΌμ΄μ–ΈνΈμ μ”μ²­ μ‹ ν•΄λ‹Ή μ•”νΈν™”λ IDλ¥Ό λ³µνΈν™”ν•μ—¬ λ‚΄λ¶€ λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ΅°νν•  μ μμµλ‹λ‹¤.

μ΄μ™€ κ°™μ΄ μ•”νΈν™” μ‹μ¤ν…μ„ λ„μ…ν•λ©΄, λ―Όκ° μ •λ³΄μ λ…Έμ¶ μ„ν—μ„ μ¤„μ΄κ³  λ³΄μ•μ„ κ°•ν™”ν•  μ μμµλ‹λ‹¤.

---

## 6. λ§μΉλ©°

μ¤λμ€ **μ•”νΈν™” μ‹μ¤ν… κµ¬ν„**μ— λ€ν•΄ μ‚΄ν΄λ³΄μ•μµλ‹λ‹¤.  
`CryptoUtil` ν΄λμ¤λ¥Ό ν†µν•΄ κ°„λ‹¨ν•κ² μ•”νΈν™”μ™€ λ³µνΈν™” κΈ°λ¥μ„ κµ¬ν„ν•  μ μμ—κ³ , μ΄λ¥Ό ν†µν•΄ ν”„λ΅μ νΈ IDμ™€ κ°™μ€ λ―Όκ°ν• λ°μ΄ν„°λ¥Ό ν¨κ³Όμ μΌλ΅ λ³΄νΈν•  μ μμμ„ ν™•μΈν–μµλ‹λ‹¤.

λ‹¤μ κΈ€μ—μ„λ” **API μ—”λ“ν¬μΈνΈ κ°μ„ ** λ° λΉ„λ™κΈ° λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬ μ μ©μ— λ€ν•΄ λ‹¤λ£° μμ •μ…λ‹λ‹¤.

κ°μ‚¬ν•©λ‹λ‹¤. λ‹¤μ κΈ€μ—μ„ λ λ§λ‚μ”! π€

---
